# Logs directory

This directory contains application logs generated by Winston.

## Log Files Structure:

- `application-YYYY-MM-DD.log` - All application logs (debug, info, warn, error)
- `error-YYYY-MM-DD.log` - Error logs only
- `info-YYYY-MM-DD.log` - Info level logs and above (production)

## Log Rotation:

- Daily rotation based on date pattern
- Compressed archive after rotation
- Maximum file size: 20MB
- Retention period: 14 days

## Log Levels:

- `debug` - Development detailed logs
- `info` - General information
- `warn` - Warning messages
- `error` - Error messages with stack traces

---

## Hướng dẫn tích hợp Filebeat với log file của app (Winston)

### 1. Cài đặt Filebeat

- Tải Filebeat từ https://www.elastic.co/downloads/beats/filebeat
- Giải nén và cài đặt theo hướng dẫn của Elastic

### 2. Cấu hình filebeat.yml

- Copy file `filebeat.yml` mẫu ở thư mục gốc dự án vào thư mục cài đặt Filebeat
- Sửa lại đường dẫn log nếu cần (theo cấu trúc logs/ của app)
- Đảm bảo các dòng sau đúng:
  ```yaml
  filebeat.inputs:
    - type: log
      enabled: true
      paths:
        - ./logs/application-*.log
        - ./logs/error-*.log
        - ./logs/info-*.log
      json.keys_under_root: true
      json.add_error_key: true
      json.message_key: message
  output.logstash:
    hosts: ["localhost:5044"]
  ```
- Nếu dùng Logstash trên server khác, sửa lại host cho phù hợp

### 3. Khởi động Filebeat

- Chạy lệnh:
  ```bash
  ./filebeat -e -c filebeat.yml
  ```
- Kiểm tra log của Filebeat để đảm bảo không có lỗi
- Kiểm tra Logstash/Elasticsearch đã nhận log chưa (xem Kibana dashboard)

### 4. Tích hợp với Logstash/ELK

- Đảm bảo Logstash đã cấu hình input từ beats (port 5044)
- Ví dụ cấu hình Logstash:
  ```
  input {
    beats {
      port => 5044
    }
  }
  filter {
    json {
      source => "message"
      skip_on_invalid_json => true
    }
  }
  output {
    elasticsearch {
      hosts => ["localhost:9200"]
      index => "farmhub-logs-%{+YYYY.MM.dd}"
    }
    stdout { codec => rubydebug }
  }
  ```
- Khởi động lại Logstash nếu thay đổi cấu hình

### 5. Kiểm tra log trên Kibana

- Truy cập Kibana, tạo index pattern phù hợp (ví dụ: `farmhub-logs-*`)
- Xem log, tạo dashboard, alert theo nhu cầu

### 6. Lưu ý
- Đảm bảo quyền đọc file log cho user chạy Filebeat
- Có thể chạy Filebeat như service để tự động start cùng hệ thống
- Tham khảo thêm: https://www.elastic.co/guide/en/beats/filebeat/current/index.html
